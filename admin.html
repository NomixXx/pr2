<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UpTaxi - Админ панель</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <nav class="admin-sidebar">
            <div class="admin-header">
                <div class="admin-logo" id="adminUserInitials">A</div>
                <h1 class="admin-title">Админ панель</h1>
                <p class="admin-subtitle" id="adminCurrentUser">Администратор</p>
            </div>
            
            <div class="admin-nav">
                <div class="admin-nav-item active">
                    <a href="#" onclick="showAdminSection('dashboard')">
                        <i class="fas fa-tachometer-alt"></i>
                        Дашборд
                    </a>
                </div>
                <div class="admin-nav-item">
                    <a href="#" onclick="showAdminSection('users')">
                        <i class="fas fa-users"></i>
                        Пользователи
                    </a>
                </div>
                <div class="admin-nav-item">
                    <a href="#" onclick="showAdminSection('sections')">
                        <i class="fas fa-folder"></i>
                        Разделы
                    </a>
                </div>
                <div class="admin-nav-item">
                    <a href="#" onclick="showAdminSection('access')">
                        <i class="fas fa-key"></i>
                        Уровни доступа
                    </a>
                </div>
                <div class="admin-nav-item">
                    <a href="#" onclick="showAdminSection('content')">
                        <i class="fas fa-file-text"></i>
                        Контент
                    </a>
                </div>
                <div class="admin-nav-item">
                    <a href="#" onclick="showAdminSection('docs')">
                        <i class="fas fa-file-alt"></i>
                        Документы
                    </a>
                </div>
                <div class="admin-nav-item">
                    <a href="#" onclick="showAdminSection('files')">
                        <i class="fas fa-paperclip"></i>
                        Файлы
                    </a>
                </div>
                <div class="admin-nav-item">
                    <a href="#" onclick="showAdminSection('activities')">
                        <i class="fas fa-bell"></i>
                        Активности
                    </a>
                </div>
                <div class="admin-nav-item">
                    <a href="#" onclick="showAdminSection('subsections')">
                        <i class="fas fa-sitemap"></i>
                        Подразделы
                    </a>
                </div>
            </div>
            
            <div class="user-info">
                <button class="logout-btn" onclick="auth.logout()" style="width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 10px; border-radius: 6px; cursor: pointer; margin: 20px;">
                    <i class="fas fa-sign-out-alt"></i> Выйти
                </button>
            </div>
        </nav>
        
        <main class="admin-main">
            <!-- Дашборд -->
            <div id="dashboard-section" class="admin-section active">
                <div class="section-header">
                    <h2 class="section-title">Дашборд</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Пользователи</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalSections">0</div>
                        <div class="stat-label">Разделы</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalContent">0</div>
                        <div class="stat-label">Контент</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalDocs">0</div>
                        <div class="stat-label">Документы</div>
                    </div>
                </div>
            </div>

            <!-- Пользователи -->
            <div id="users-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">Управление пользователями</h2>
                    <button class="btn-primary" onclick="openModal('createUserModal')">
                        <i class="fas fa-plus"></i>
                        Добавить пользователя
                    </button>
                </div>
                <div class="data-grid" id="users-grid">
                    <!-- Пользователи будут загружены динамически -->
                </div>
            </div>

            <!-- Разделы -->
            <div id="sections-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">Управление разделами</h2>
                    <button class="btn-primary" onclick="openModal('createSectionModal')">
                        <i class="fas fa-plus"></i>
                        Добавить раздел
                    </button>
                </div>
                <div class="data-grid" id="sections-grid">
                    <!-- Разделы будут загружены динамически -->
                </div>
            </div>

            <!-- Уровни доступа -->
            <div id="access-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">Уровни доступа</h2>
                    <button class="btn-primary" onclick="openModal('createAccessModal')">
                        <i class="fas fa-plus"></i>
                        Добавить уровень
                    </button>
                </div>
                <div class="data-grid" id="access-grid">
                    <!-- Уровни доступа будут загружены динамически -->
                </div>
            </div>

            <!-- Контент -->
            <div id="content-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">Управление контентом</h2>
                    <button class="btn-primary" onclick="openModal('addContentModal')">
                        <i class="fas fa-plus"></i>
                        Добавить контент
                    </button>
                </div>
                <div class="data-grid" id="content-grid">
                    <!-- Контент будет загружен динамически -->
                </div>
            </div>

            <!-- Документы -->
            <div id="docs-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">Google Документы</h2>
                    <button class="btn-primary" onclick="openModal('addDocModal')">
                        <i class="fas fa-plus"></i>
                        Добавить документ
                    </button>
                </div>
                <div class="data-grid" id="docs-grid">
                    <!-- Документы будут загружены динамически -->
                </div>
            </div>

            <!-- Файлы -->
            <div id="files-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">Управление файлами</h2>
                    <div>
                        <input type="file" id="fileUpload" multiple style="display: none;">
                        <button class="btn-primary" onclick="document.getElementById('fileUpload').click()">
                            <i class="fas fa-upload"></i>
                            Загрузить файлы
                        </button>
                    </div>
                </div>
                <div class="data-grid" id="files-grid">
                    <!-- Файлы будут загружены динамически -->
                </div>
            </div>

            <!-- Активности -->
            <div id="activities-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">Активности</h2>
                    <button class="btn-primary" onclick="openModal('addActivityModal')">
                        <i class="fas fa-plus"></i>
                        Добавить активность
                    </button>
                </div>
                <div class="data-grid" id="activities-grid">
                    <!-- Активности будут загружены динамически -->
                </div>
            </div>

            <!-- Подразделы -->
            <div id="subsections-section" class="admin-section">
                <div class="section-header">
                    <h2 class="section-title">Управление подразделами</h2>
                </div>
                <div class="filter-section">
                    <h3>Фильтр по разделам</h3>
                    <select id="sectionFilter" onchange="filterSubsectionContent()">
                        <option value="">Все разделы</option>
                    </select>
                </div>
                <div class="data-grid" id="subsections-grid">
                    <!-- Подразделы будут загружены динамически -->
                </div>
            </div>
        </main>
    </div>

    <!-- Модальные окна -->
    
    <!-- Создание пользователя -->
    <div id="createUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Добавить пользователя</h3>
                <button class="close" onclick="closeModal('createUserModal')">&times;</button>
            </div>
            <form id="createUserForm">
                <div class="form-group">
                    <label>Имя пользователя</label>
                    <input type="text" id="newUsername" required>
                </div>
                <div class="form-group">
                    <label>Пароль</label>
                    <input type="password" id="newPassword" required>
                </div>
                <div class="form-group">
                    <label>Роль</label>
                    <select id="newUserRole">
                        <option value="user">Пользователь</option>
                        <option value="admin">Администратор</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Уровень доступа</label>
                    <select id="newUserAccess">
                        <option value="1">Уровень 1</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('createUserModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Создать</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Редактирование пользователя -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Редактировать пользователя</h3>
                <button class="close" onclick="closeModal('editUserModal')">&times;</button>
            </div>
            <form id="editUserForm">
                <input type="hidden" id="editUserOldUsername">
                <div class="form-group">
                    <label>Имя пользователя</label>
                    <input type="text" id="editUsername" required>
                </div>
                <div class="form-group">
                    <label>Пароль</label>
                    <input type="password" id="editPassword" required>
                </div>
                <div class="form-group">
                    <label>Роль</label>
                    <select id="editUserRole">
                        <option value="user">Пользователь</option>
                        <option value="admin">Администратор</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Уровень доступа</label>
                    <select id="editUserAccess">
                        <option value="1">Уровень 1</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('editUserModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Создание раздела -->
    <div id="createSectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Добавить раздел</h3>
                <button class="close" onclick="closeModal('createSectionModal')">&times;</button>
            </div>
            <form id="createSectionForm">
                <div class="form-group">
                    <label>Название раздела</label>
                    <input type="text" id="sectionName" required>
                </div>
                <div class="form-group">
                    <label>Иконка (emoji)</label>
                    <input type="text" id="sectionIcon" placeholder="📁" required>
                </div>
                <div class="form-group">
                    <label>Уровень доступа</label>
                    <select id="sectionAccess">
                        <option value="1">Уровень 1</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('createSectionModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Создать</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Редактирование раздела -->
    <div id="editSectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Редактировать раздел</h3>
                <button class="close" onclick="closeModal('editSectionModal')">&times;</button>
            </div>
            <form id="editSectionForm">
                <input type="hidden" id="editSectionId">
                <div class="form-group">
                    <label>Название раздела</label>
                    <input type="text" id="editSectionName" required>
                </div>
                <div class="form-group">
                    <label>Иконка (emoji)</label>
                    <input type="text" id="editSectionIcon" required>
                </div>
                <div class="form-group">
                    <label>Уровень доступа</label>
                    <select id="editSectionAccess">
                        <option value="1">Уровень 1</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Подразделы</label>
                    <div id="editSubsectionsList">
                        <!-- Подразделы будут загружены динамически -->
                    </div>
                    <button type="button" class="btn-secondary" onclick="addSubsectionToEdit()">Добавить подраздел</button>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('editSectionModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Создание уровня доступа -->
    <div id="createAccessModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Добавить уровень доступа</h3>
                <button class="close" onclick="closeModal('createAccessModal')">&times;</button>
            </div>
            <form id="createAccessForm">
                <div class="form-group">
                    <label>Название</label>
                    <input type="text" id="accessName" required>
                </div>
                <div class="form-group">
                    <label>Описание</label>
                    <textarea id="accessDescription" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('createAccessModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Создать</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Редактирование уровня доступа -->
    <div id="editAccessModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Редактировать уровень доступа</h3>
                <button class="close" onclick="closeModal('editAccessModal')">&times;</button>
            </div>
            <form id="editAccessForm">
                <input type="hidden" id="editAccessId">
                <div class="form-group">
                    <label>Название</label>
                    <input type="text" id="editAccessName" required>
                </div>
                <div class="form-group">
                    <label>Описание</label>
                    <textarea id="editAccessDescription" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('editAccessModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Добавление контента -->
    <div id="addContentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Добавить контент</h3>
                <button class="close" onclick="closeModal('addContentModal')">&times;</button>
            </div>
            <form id="addContentForm">
                <div class="form-group">
                    <label>Раздел</label>
                    <select id="contentSection" required>
                        <option value="">Выберите раздел</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Подраздел</label>
                    <select id="contentSubsection" required>
                        <option value="">Сначала выберите раздел</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Заголовок</label>
                    <input type="text" id="contentTitle" required>
                </div>
                <div class="form-group">
                    <label>Описание</label>
                    <textarea id="contentDescription" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('addContentModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Добавить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Редактирование контента -->
    <div id="editContentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Редактировать контент</h3>
                <button class="close" onclick="closeModal('editContentModal')">&times;</button>
            </div>
            <form id="editContentForm">
                <input type="hidden" id="editContentKey">
                <input type="hidden" id="editContentId">
                <div class="form-group">
                    <label>Заголовок</label>
                    <input type="text" id="editContentTitle" required>
                </div>
                <div class="form-group">
                    <label>Описание</label>
                    <textarea id="editContentDescription" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('editContentModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Добавление документа -->
    <div id="addDocModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Добавить Google документ</h3>
                <button class="close" onclick="closeModal('addDocModal')">&times;</button>
            </div>
            <form id="addDocForm">
                <div class="form-group">
                    <label>Раздел</label>
                    <select id="docSection" required>
                        <option value="">Выберите раздел</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Подраздел</label>
                    <select id="docSubsection" required>
                        <option value="">Сначала выберите раздел</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Название документа</label>
                    <input type="text" id="docTitle" required>
                </div>
                <div class="form-group">
                    <label>URL документа</label>
                    <input type="url" id="docUrl" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('addDocModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Добавить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Добавление активности -->
    <div id="addActivityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Добавить активность</h3>
                <button class="close" onclick="closeModal('addActivityModal')">&times;</button>
            </div>
            <form id="addActivityForm">
                <div class="form-group">
                    <label>Название активности</label>
                    <input type="text" id="activityTitle" required>
                </div>
                <div class="form-group">
                    <label>Иконка (emoji)</label>
                    <input type="text" id="activityIcon" placeholder="📝" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('addActivityModal')">Отмена</button>
                    <button type="submit" class="btn-primary">Добавить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Модальное окно для Google Docs -->
    <div id="googleDocModal" class="modal google-doc-modal">
        <div class="modal-content">
            <div class="google-doc-header">
                <h3 class="google-doc-title" id="googleDocTitle">Документ</h3>
                <div class="google-doc-actions">
                    <button class="btn-link" onclick="openGoogleDocInNewTab()">
                        <i class="fas fa-external-link-alt"></i> Открыть в новой вкладке
                    </button>
                    <button class="close" onclick="closeModal('googleDocModal')">&times;</button>
                </div>
            </div>
            <iframe id="googleDocFrame" class="google-doc-frame" src="/placeholder.svg"></iframe>
        </div>
    </div>

    <script>
        // Обработчик загрузки файлов
        document.getElementById('fileUpload').addEventListener('change', uploadFiles);
    </script>
    <script src="js/api-client.js"></script>
    <script src="script.js"></script>
    <script src="admin.js"></script>
</body>
</html>
